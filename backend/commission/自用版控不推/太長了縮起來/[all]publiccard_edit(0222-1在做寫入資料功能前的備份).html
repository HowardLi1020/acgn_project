{% extends '[BASE]ALL.html' %}
{% load static %} 
{% block app_css %}
<!-- 如果應用程式有自己的css放這邊 -->
<style>
  /* 隱藏頂端列 */
  .app-header-inner {
    display: none;
  }
  /* 取消主板 .app 的 padding-top 設置 */
  .app {
    padding-top: 0 !important;
  }

  /* 頭像和個人資訊容器 */
  .profile-info-container {
    position: absolute;
    top: -120px; /* 頭像與 banner 的高度距離，數字越小越上方 */
    left: 50px; /* 頭像與左邊界的距離 */
    right: 20px;
    z-index: 1;
    overflow: visible; /* 允許內容超出容器 */
  }

  /* 開關樣式 */
  /* .switch {
    position: relative;
    display: inline-block;
    width: 60px;
    height: 34px;
  } */

  /* 開關輸入樣式 */
  /* .switch input {
    opacity: 0;
    width: 0;
    height: 0;
  } */

  /* 開關滑塊樣式 */
  /* .slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: #ccc;
    transition: 0.4s;
    border-radius: 34px;
  } */

  /* 開關滑塊前景樣式 */
  /* .slider:before {
    position: absolute;
    content: "";
    height: 26px;
    width: 26px;
    left: 4px;
    bottom: 4px;
    background-color: white;
    border-radius: 50%;
    transition: 0.4s;
  } */


  /* 右側區域容器樣式 */
  .right-section {
    position: static; /* 移除相對定位 */
    flex: 1; /* 讓右側區域佔據剩餘空間 */
    padding-left: 40px; /* 與左側區域保持間距 */
  }

  /* 開關容器樣式 */
  /* .switches-container { */
    /* display: grid; */
    /* grid-template-columns: repeat(2, 1fr); 2x2 網格布局 */
    /* gap: 15px; */
  /* } */

  


  /* 頭像與橫幅-自訂圖開關的字體大小 */
  .form-check-label {
    font-size: 0.85rem; /*  調整字體大小 */
  }


  /* 右側開關區域的獨立樣式 */
  .right-section .form-check {
    position: relative; /* 設置相對定位作為參考點 */
    padding-right: 60px; /* 為開關預留空間 */
    margin-bottom: 1rem;
  }

  /* 右側區域表單標籤樣式 */
  .right-section .form-check-label {
    font-size: 1rem;
  }

  /* 右側區域表單輸入樣式 */
  .right-section .form-check-input {
    position: absolute; /* 絕對定位 */
    right: 40rem; /* 文字與開關的距離，越大越近 */
    top: 40%; /* 垂直置中 */
    transform: translateY(-50%); /* 精確垂直置中 */
    margin: 0; /* 清除預設邊距 */
  }

  /* 列表樣式 */
  .content-list {
    /*list-style: none;  移除預設的列表符號 */
    padding: 0;
    margin: 0;
  }

  /* 內容列表項目樣式 */
  .content-list li {
    position: relative;
    padding-left: 1.5em; /* 為自訂符號留空間 */
    margin-bottom: 1rem;
  }

  /* 內容列表項目前景樣式 */
  .content-list li::before {
    /* content: "●"; */
    position: absolute;
    left: 0;
    color: #333;
  }

  /* 開關容器樣式 */
  .content-list .form-check {
    display: flex;
    flex-direction: row-reverse;
    justify-content: space-between;
    align-items: center;
    margin: 0;
    padding: 0;
  }

  /* 內容列表表單標籤樣式 */
  .content-list .form-check-label {
    font-size: 1rem;
    margin-right: 10px;
  }

  /* 開關展開內容區域 */
  .expandable-content {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.3s ease-out;
    padding-left: 1.5em;
  }

  /* 開關展開時的狀態 */
  .expandable-content.show {
    max-height: 5000px; /* 設置一個足夠大的高度，但不要太大以免影響動畫效果 */
    transition: max-height 0.5s ease-in;
  }

  /* 調整按鈕樣式以匹配輸入框高度 */
  .input-group .btn {
    height: 40px; /* 使按鈕高度與輸入框相同 */
    padding: 0.375rem 0.75rem; /* 調整內邊距 */
    display: flex; /* 確保按鈕內部元素垂直居中 */
    align-items: center; /* 垂直居中 */
  }




  /* 修正 form-check 的樣式 */
  .content-list .form-check.me-3 {
    flex-direction: row; /* 覆蓋 row-reverse */
    justify-content: flex-start; /* 覆蓋 space-between */
  }



  /* 輸入框(含喜好作品、屬性Tag、價目表區)-提示字 placeholder 樣式 */
  .form-control::placeholder {
    font-size: 0.875rem;  /* 14px，比預設的 16px 小一點 */
    color: #7b838d;          /* 淺灰色 */
    opacity: 0.8;         /* 稍微調整透明度 */
  }

  
  /* 表單組樣式 */
  /* .profile-form .form-group {
    margin-bottom: 1rem;
  } */

  /* 表單控制樣式 */
  /* .profile-form .form-control {
    width: 100%;
  } */

  
</style>
{% endblock %}
{% block app_title %}
<!-- 直接打文字即可替換各自應用程式的標題 -->
名片資訊編輯 (使用者ID：{{ ViewKey_DbPublicCardInfo.pk }}) 

{% endblock %} 
{% block app_content %}
<!-- 白底編輯區 -->
<div
  class="app-card app-card-settings shadow-sm p-4 mb-4 d-flex flex-column"
  style="flex-grow: 1"
>
  <form method="post" enctype="multipart/form-data">
    {% include 'commission/publiccard_edit_test/banner.html' %}
    

    <!-- 頭像和個人資訊區域 -->
    <div class="profile-info-container d-flex position-relative">
      {% include 'commission/publiccard_edit_test/avatar.html' %}
      {% include 'commission/publiccard_edit_test/user_info.html' %}      
    </div>

    <!-- 新增一個容器來包住兩個區塊 -->
    <div class="sections-container" style="display: flex; margin-top: -90px">
      <!-- 左側區域 -->
      {% include 'commission/publiccard_edit_test/favorite_and_tag.html' %}

      <!-- 右側區域(分隔線區分兩側) -->
      <div class="right-section" style="border-left: 1px solid #dee2e6;">
        <ul class="content-list">
          {% include 'commission/publiccard_edit_test/sell_list.html' %}
          {% include 'commission/publiccard_edit_test/work_sellnow.html' %}
          {% include 'commission/publiccard_edit_test/work_done.html' %}
          {% include 'commission/publiccard_edit_test/need.html' %}
        </ul>
      </div>
    </div>
    <div class="d-flex justify-content-end mt-3">
      <a href="#" id="cancelButton" class="btn app-btn-secondary me-2"
        >返回上層</a
      >
      <button type="submit" class="btn app-btn-warning me-1" style="background-color: #facf4d; border-color: #facf4d">保存非公開</button>
      <button type="submit" class="btn app-btn-primary">保存並公開</button>
    </div>
  </form>
</div>

<!-- </div> -->

<!-- <div class="flex-grow-1"></div> -->
<!-- </div> -->

<!--//row-->
{% endblock %} 
{% block app_script %}
<!-- 如果應用程式有自己的JAVA Script放這邊 -->
</script>

<!-- 新增 Sortable.js 拖曳排序功能 -->
<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
<script>


//   // === 修正其他開關的事件監聽器 ===
//   const switches = document.querySelectorAll(".form-check-input");
//   switches.forEach((switchEl) => {
//     switchEl.addEventListener("change", function () {
//       const contentId = "content-" + this.id.split("-")[1];
//       const contentEl = document.getElementById(contentId);
      
//       // 加入檢查
//       if (contentEl) {
//         if (this.checked) {
//           contentEl.classList.add("show");
//         } else {
//           contentEl.classList.remove("show");
//         }
//       }
//     });
//   });

// // === 原 toggleContent 函數，處理內容顯示/隱藏 ===
// window.toggleContent = function(contentId) {
//   const content = document.getElementById(contentId);
//   if (content) {
//     content.classList.toggle("show");
//   }
// };


// === 右側內容區域開關-初始化開關狀態並添加事件監聽器 ===
const switchStates = {
  // '開關控制ID': {# {從views.py連動的資料表.資料表欄位|統一轉換為小寫 }#}
  'switch-sell': {{ ViewKey_DbPublicCardInfo.sell_public_status|lower }},
  'switch-work-sellnow': {{ ViewKey_DbPublicCardInfo.work_sellnow_list_public_status|lower }},
  'switch-work-done': {{ ViewKey_DbPublicCardInfo.work_done_list_public_status|lower }},
  'switch-need-list': {{ ViewKey_DbPublicCardInfo.need_list_public_status|lower }}
};

// 右側內容區域開關-初始化每個開關的狀態
Object.entries(switchStates).forEach(([switchId, initialState]) => {
  const switchElement = document.getElementById(switchId);
  if (switchElement) {
    // 設置初始狀態
    switchElement.checked = initialState;
    // 初始化內容區域的顯示狀態
    const contentId = `content-${switchId.replace('switch-', '')}`;
    const contentEl = document.getElementById(contentId);
    const privateMessage = contentEl.previousElementSibling;
    
    if (contentEl) {
      // 控制初始化時的顯示內容
      if (initialState) { 
        // 如果開關狀態(取自資料表欄位資料)為 true，顯示原定內容，隱藏「使用者未開放資訊」字樣
        privateMessage.style.display = 'none';
        contentEl.classList.add("show");
      } else {
        privateMessage.style.display = 'block';
        contentEl.classList.remove("show");
      }
    }
    // 開關事件監聽器
    switchElement.addEventListener('change', function(e) {
      // const contentId = `content-${switchId.replace('switch-', '')}`;
      // const contentEl = document.getElementById(contentId);
      // const privateMessage = contentEl.previousElementSibling;
      
      if (contentEl) {
        // 控制模板開關改變時的顯示內容
        if (this.checked) {
          // 開關開啟：顯示公開內容，隱藏「使用者未開放資訊」字樣
          privateMessage.style.display = 'none';
          contentEl.classList.add("show");
        } else {
          // 開關關閉：顯示「使用者未開放資訊」字樣，隱藏公開內容
          privateMessage.style.display = 'block';
          contentEl.classList.remove("show");
        }
      }
    });
  }
});










</script>

{% endblock %}
