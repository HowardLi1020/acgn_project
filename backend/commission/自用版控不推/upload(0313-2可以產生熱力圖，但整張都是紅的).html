{% extends '[BASE]ALL.html' %}
{% load static %} 
{% block app_css %}
<style>
.upload-container {
    max-width: 600px;
    margin: 0 auto;
    padding: 20px;
    background-color: #f8f9fa;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.upload-title {
    margin-bottom: 20px;
    color: #333;
    text-align: center;
}

.upload-description {
    margin-bottom: 20px;
    color: #666;
    text-align: center;
}

.file-upload-area {
    border: 2px dashed #ccc;
    padding: 30px;
    text-align: center;
    margin-bottom: 20px;
    border-radius: 5px;
    background-color: #fff;
    transition: all 0.3s;
}

.file-upload-area:hover {
    border-color: #0066cc;
}

.file-input {
    display: none;
}

.file-label {
    display: inline-block;
    padding: 10px 20px;
    background-color: #0066cc;
    color: white;
    border-radius: 5px;
    cursor: pointer;
    transition: background-color 0.3s;
}

.file-label:hover {
    background-color: #0055aa;
}

.file-name {
    margin-top: 10px;
    font-style: italic;
    color: #666;
}

.submit-button {
    display: block;
    width: 100%;
    padding: 10px;
    background-color: #28a745;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-size: 16px;
    transition: background-color 0.3s;
}

.submit-button:hover {
    background-color: #218838;
}

.submit-button:disabled {
    background-color: #6c757d;
    cursor: not-allowed;
}

.info-box {
    margin-top: 30px;
    padding: 15px;
    background-color: #e7f5ff;
    border-left: 5px solid #0066cc;
    border-radius: 5px;
}

.info-title {
    font-weight: bold;
    margin-bottom: 10px;
    color: #0066cc;
}
</style>
{% endblock %}

{% block app_content %}
<div class="container mt-4">
    <div class="upload-container">
        <h1 class="upload-title">AI 圖片比對</h1>
        <p class="upload-description">上傳一張圖片，我們將在資料庫中尋找相似的圖片，並使用 AI 技術分析相似度。</p>
        
        <form action="{% url 'commission:Urls_upload_compare' %}" method="post" enctype="multipart/form-data" id="upload-form">
            {% csrf_token %}
            
            <div class="file-upload-area" id="drop-area">
                <input type="file" name="image" id="file-input" class="file-input" accept="image/*">
                <label for="file-input" class="file-label">選擇圖片</label>
                <p class="mt-2">或將圖片拖放到此處</p>
                <div class="file-name" id="file-name"></div>
            </div>
            
            <button type="submit" class="submit-button" id="submit-button" disabled>上傳並比對</button>
        </form>
        
        <div class="info-box">
            <div class="info-title">關於 AI 圖片比對</div>
            <p>我們使用 CLIP 模型進行圖片比對，該模型能夠理解圖片的視覺特徵和語義內容。</p>
            <p>比對結果將顯示：</p>
            <ul>
                <li>相似度百分比</li>
                <li>最相似的圖片</li>
                <li>Grad-CAM 視覺化分析（顯示 AI 關注的區域）</li>
            </ul>
            <p>此功能可用於檢測相似作品或尋找靈感來源。</p>
        </div>
    </div>
</div>
{% endblock %}

{% block app_script %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const fileInput = document.getElementById('file-input');
    const fileName = document.getElementById('file-name');
    const submitButton = document.getElementById('submit-button');
    const dropArea = document.getElementById('drop-area');
    
    // 文件選擇事件
    fileInput.addEventListener('change', function() {
        if (fileInput.files.length > 0) {
            fileName.textContent = fileInput.files[0].name;
            submitButton.disabled = false;
        } else {
            fileName.textContent = '';
            submitButton.disabled = true;
        }
    });
    
    // 拖放功能
    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
        dropArea.addEventListener(eventName, preventDefaults, false);
    });
    
    function preventDefaults(e) {
        e.preventDefault();
        e.stopPropagation();
    }
    
    ['dragenter', 'dragover'].forEach(eventName => {
        dropArea.addEventListener(eventName, highlight, false);
    });
    
    ['dragleave', 'drop'].forEach(eventName => {
        dropArea.addEventListener(eventName, unhighlight, false);
    });
    
    function highlight() {
        dropArea.style.borderColor = '#0066cc';
        dropArea.style.backgroundColor = '#f0f7ff';
    }
    
    function unhighlight() {
        dropArea.style.borderColor = '#ccc';
        dropArea.style.backgroundColor = '#fff';
    }
    
    dropArea.addEventListener('drop', handleDrop, false);
    
    function handleDrop(e) {
        const dt = e.dataTransfer;
        const files = dt.files;
        
        if (files.length > 0) {
            fileInput.files = files;
            fileName.textContent = files[0].name;
            submitButton.disabled = false;
        }
    }
});
</script>
{% endblock %}
